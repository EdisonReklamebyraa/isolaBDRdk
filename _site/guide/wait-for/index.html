<h1 id="data-dependencies">Data Dependencies</h1>

<p>Dealing with data dependencies between stores is often a tricky and time consuming endeavour. This is one of the reasons why flux was originally built. Flux comes with this method called <code>waitFor</code> which signals to the dispatcher that this store depends on another store for its data.</p>

<p>Say we have a new <code>FavoritesStore</code> where you’ll be able to mark your favorite locations. We want to update the LocationStore only after the FavoriteStore gets its update.</p>

<p>First lets add a new action to our LocationActions.</p>

<p><code>actions/LocationActions.js</code></p>

<p><code>js
favoriteLocation(locationId) {
  this.dispatch(locationId);
}
</code></p>

<p>Next, lets build our FavoritesStore.</p>

<p><code>stores/FavoritesStore.js</code></p>

<p>```js
var alt = require(‘../alt’);
var LocationActions = require(‘../actions/LocationActions’);</p>

<p>class FavoritesStore {
  constructor() {
    this.locations = [];</p>

<pre><code>this.bindListeners({
  addFavoriteLocation: LocationActions.FAVORITE_LOCATION
});   }
</code></pre>

<p>addFavoriteLocation(location) {
    this.locations.push(location);
  }
}</p>

<p>module.exports = alt.createStore(FavoritesStore, ‘FavoritesStore’);
```</p>

<p>And finally lets set the waitFor dependency in our LocationStore. But first, make sure you bind the new action to a new action handler in the store.</p>

<p><code>js
this.bindListeners({
  handleUpdateLocations: LocationActions.UPDATE_LOCATIONS,
  handleFetchLocations: LocationActions.FETCH_LOCATIONS,
  handleLocationsFailed: LocationActions.LOCATIONS_FAILED,
  setFavorites: LocationActions.FAVORITE_LOCATION
});
</code></p>

<p>And lets create the action handler with <code>waitFor</code>.</p>

<p>```js
resetAllFavorites() {
  this.locations = this.locations.map((location) =&gt; {
    return {
      id: location.id,
      name: location.name,
      has_favorite: false
    };
  });
}</p>

<p>setFavorites(location) {
  this.waitFor(FavoritesStore);</p>

<p>var favoritedLocations = FavoritesStore.getState().locations;</p>

<p>this.resetAllFavorites();</p>

<p>favoritedLocations.forEach((location) =&gt; {
    // find each location in the array
    for (var i = 0; i &lt; this.locations.length; i += 1) {</p>

<pre><code>  // set has_favorite to true
  if (this.locations[i].id === location.id) {
    this.locations[i].has_favorite = true;
    break;
  }
}   }); } ```
</code></pre>

<p>You can check out the working final result <a href="https://github.com/goatslacker/alt-tutorial">here</a>.</p>
